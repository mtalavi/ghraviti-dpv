# PHP Application Configuration for Coolify/Nixpacks

[variables]
    NIXPACKS_PHP_VERSION = '8.3'
    PORT = '80'

# Setup phase: Install required packages
[phases.setup]
    nixPkgs = [
        'php83',
        'php83Extensions.pdo_mysql',
        'php83Extensions.openssl',
        'php83Extensions.mbstring',
        'php83Extensions.gd',
        'nginx',
        'libmysqlclient',
        'php83Packages.composer'
    ]

# Install phase: Create necessary directories
[phases.install]
    cmds = [
        'mkdir -p /var/log/nginx',
        'mkdir -p /var/cache/nginx',
        'mkdir -p /run'
    ]

# Start command: Run PHP-FPM and Nginx directly (no Node.js needed)
[start]
    cmd = 'php-fpm -y /assets/php-fpm.conf & nginx -g "daemon off;"'